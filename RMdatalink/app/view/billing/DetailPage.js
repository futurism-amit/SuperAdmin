/*
 * File: app/view/billing/DetailPage.js
 *
 * This file was generated by Sencha Architect version 3.0.4.
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Sencha Touch 2.3.x library, under independent license.
 * License of Sencha Architect does not include license for Sencha Touch 2.3.x. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('RMdatalink.view.billing.DetailPage', {
    extend: 'Ext.Container',
    alias: 'widget.billingdetailpage',

    requires: [
        'RMdatalink.view.productDatalinkInvoice',
        'RMdatalink.view.listWithHeader',
        'RMdatalink.view.billing.detailedListContainer',
        'Ext.Label',
        'Ext.form.Panel',
        'Ext.form.FieldSet',
        'Ext.Img',
        'Ext.field.Select',
        'Ext.field.Search',
        'Ext.Button',
        'Ext.field.TextArea',
        'Ext.tab.Panel',
        'Ext.tab.Bar',
        'Ext.field.File',
        'Ext.field.Number',
        'Ext.field.Email',
        'Ext.field.Url'
    ],

    config: {
        height: '100%',
        width: '100%',
        layout: 'vbox',
        items: [
            {
                xtype: 'container',
                flex: 15,
                layout: 'hbox',
                items: [
                    {
                        xtype: 'container',
                        action: 'setScrollBarVisible',
                        flex: 4,
                        cls: 'borderedDiv',
                        itemId: 'billingSubscriptionsTab',
                        margin: '2 0 0 0',
                        padding: '4 10 4 10',
                        scrollable: true,
                        layout: {
                            type: 'vbox',
                            align: 'start'
                        },
                        listeners: [
                            {
                                fn: function(component, eOpts) {

                                },
                                event: 'initialize'
                            }
                        ],
                        items: [
                            {
                                xtype: 'panel',
                                hidden: true,
                                width: '100%',
                                layout: {
                                    type: 'hbox',
                                    align: 'start'
                                },
                                items: [
                                    {
                                        xtype: 'label',
                                        html: 'Product',
                                        margin: '0 0 0 5px'
                                    }
                                ]
                            },
                            {
                                xtype: 'productdatalinkinvoice',
                                height: 600,
                                hidden: true,
                                width: '99%'
                            },
                            {
                                xtype: 'formpanel',
                                action: 'setScrollBarVisible',
                                cls: ' x-rm-rdformpanel',
                                height: 1200,
                                id: 'productRmproInvoicePanel',
                                itemId: 'productRmproInvoicePanel',
                                width: '99%',
                                scrollable: false,
                                layout: {
                                    type: 'vbox',
                                    align: 'start'
                                },
                                items: [
                                    {
                                        xtype: 'fieldset',
                                        baseCls: 'none',
                                        border: '0 0 0 0',
                                        hidden: true,
                                        itemId: 'invoiceRMProHideShowFldSet',
                                        margin: '10 0 0 20',
                                        layout: 'hbox',
                                        items: [
                                            {
                                                xtype: 'image',
                                                height: '30px;',
                                                itemId: 'invoiceRMPROHideShowImg',
                                                width: 35,
                                                src: 'resources/images/labelHeader/downArrow.png',
                                                listeners: [
                                                    {
                                                        fn: function(component, eOpts) {
                                                            component.element.on('tap',function(){


                                                                var rmProBillngPanel =  component.getParent().getParent().down('#invoiceRmproBillingFldsPanel');

                                                                var childs = component.getParent().getParent().getItems().items ;
                                                                for(var i=0;i< childs.length; i++){

                                                                    if(childs[i].config.xtype =="panel"){
                                                                        var child = childs[i] ;
                                                                        child.setHidden(! child.getHidden());
                                                                        if( child.getHidden()){

                                                                            component.setSrc('resources/images/labelHeader/rightArrow.png');
                                                                        }else{
                                                                            component.setSrc('resources/images/labelHeader/downArrow.png') ;
                                                                        }

                                                                    }
                                                                }

                                                                rmProBillngPanel.setHidden(! rmProBillngPanel.getHidden());

                                                                if(rmProBillngPanel.getHidden())
                                                                {
                                                                    Ext.ComponentQuery.query('#productRmproInvoicePanel')[0].setHeight(30);
                                                                }else{

                                                                    Ext.ComponentQuery.query('#productRmproInvoicePanel')[0].setHeight(1150);
                                                                    // RMdatalink.app.getController('InvoiceController').setRMProPanelHeight() ;
                                                                    //Ext.ComponentQuery.query('#productRmproInvoicePanel')[0].setHeight(600);
                                                                }


                                                                //     var child = component.getParent().getParent().down('panel') ;
                                                                //     child.setHidden(! child.getHidden());
                                                                //     if( child.getHidden()){

                                                                //        component.setSrc('resources/images/labelHeader/rightArrow.png');
                                                                //     }else{
                                                                //         component.setSrc('resources/images/labelHeader/downArrow.png') ;
                                                                //     }

                                                            });
                                                        },
                                                        event: 'initialize'
                                                    }
                                                ]
                                            },
                                            {
                                                xtype: 'label',
                                                html: 'RMPro',
                                                itemId: 'mylabel58',
                                                style: 'font-size:12px;'
                                            },
                                            {
                                                xtype: 'label',
                                                itemId: 'billingRMProDtlsLbl',
                                                margin: '0 0 0 20',
                                                style: 'font-size:12px;'
                                            }
                                        ]
                                    },
                                    {
                                        xtype: 'fieldset',
                                        width: '100%',
                                        layout: 'hbox',
                                        items: [
                                            {
                                                xtype: 'image',
                                                height: '76px',
                                                hidden: true,
                                                margin: ' 5 5 0 5',
                                                width: 36,
                                                src: 'resources/images/invoice/address.png'
                                            },
                                            {
                                                xtype: 'fieldset',
                                                flex: 1,
                                                height: '70px',
                                                margin: '1 0 1 0',
                                                items: [
                                                    {
                                                        xtype: 'label',
                                                        itemId: 'InvoiceToNameLbl',
                                                        style: 'font-weight: bold;font-size:1.4em;margin-left: 10px;'
                                                    },
                                                    {
                                                        xtype: 'selectfield',
                                                        docked: 'bottom',
                                                        hidden: true,
                                                        itemId: 'invoiceRmProPaymentPrdSlFld',
                                                        width: '250px',
                                                        inputCls: 'borderedDiv',
                                                        label: '<b> License For: </b>',
                                                        labelCls: 'boldInputFld',
                                                        labelWidth: '110px',
                                                        value: 12,
                                                        autoSelect: false,
                                                        options: [
                                                            {
                                                                text: '1 Month',
                                                                value: 1
                                                            },
                                                            {
                                                                text: '3 Month',
                                                                value: 3
                                                            },
                                                            {
                                                                text: '6 Month',
                                                                value: 6
                                                            },
                                                            {
                                                                text: '9 Month',
                                                                value: 9
                                                            },
                                                            {
                                                                text: '1 Year',
                                                                value: 12
                                                            },
                                                            {
                                                                text: '2 Year',
                                                                value: 24
                                                            },
                                                            {
                                                                text: '3 Year',
                                                                value: 36
                                                            }
                                                        ]
                                                    }
                                                ]
                                            },
                                            {
                                                xtype: 'fieldset',
                                                layout: {
                                                    type: 'vbox',
                                                    pack: 'center'
                                                },
                                                items: [
                                                    {
                                                        xtype: 'image',
                                                        centered: false,
                                                        height: '70px',
                                                        itemId: 'printInvoicePaidStampImg',
                                                        margin: '0 20 0 20',
                                                        width: '210px',
                                                        src: 'resources/images/invoice/paid.png'
                                                    }
                                                ]
                                            },
                                            {
                                                xtype: 'fieldset',
                                                baseCls: 'x-form-fieldset normalTitle',
                                                cls: 'x-rm-no_borderflds',
                                                margin: '1 0 1 0',
                                                padding: '0 0 0 32',
                                                width: '226px',
                                                title: '<div style="margin-left: 14%; font-size:1.8em;color:rgb(48, 84, 150);font-weight: bold;">INVOICE</div>',
                                                items: [
                                                    {
                                                        xtype: 'label',
                                                        html: 'Invoice #:',
                                                        itemId: 'InvoiceNoLbl',
                                                        style: 'font-size:1.0em;font-weight:bold;'
                                                    },
                                                    {
                                                        xtype: 'label',
                                                        html: 'Date:',
                                                        itemId: 'invoiceTopDateNoLbl',
                                                        style: 'font-size:1.0em;font-weight:bold;'
                                                    },
                                                    {
                                                        xtype: 'label',
                                                        html: 'Due Date:',
                                                        itemId: 'InvoiceDueDateNoLbl',
                                                        style: 'font-size:1.0em;font-weight:bold;'
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        xtype: 'fieldset',
                                        cls: 'x-rm-no_borderflds',
                                        itemId: 'rmProextradtl',
                                        margin: '0 0 0 0',
                                        layout: 'hbox',
                                        items: [
                                            {
                                                xtype: 'label',
                                                html: '<b>Subscription License for  </b>',
                                                itemId: 'billingLiscencePrdLbl',
                                                padding: '6 0 0 0',
                                                style: 'font-size:0.8em;'
                                            },
                                            {
                                                xtype: 'textfield',
                                                disabled: true,
                                                hidden: true,
                                                itemId: 'rmProSubscrPaymentStartDateFld',
                                                width: '160px',
                                                inputCls: 'boldInputFld inputdisabledClsFldAsLbl',
                                                label: '<b>From Date</b>',
                                                labelWidth: '86px'
                                            },
                                            {
                                                xtype: 'textfield',
                                                disabled: true,
                                                hidden: true,
                                                itemId: 'rmProSubscrPaymentEndDateFld',
                                                width: '160px',
                                                inputCls: 'boldInputFld inputdisabledClsFldAsLbl',
                                                label: '<b>To Date</b>',
                                                labelWidth: '70px'
                                            },
                                            {
                                                xtype: 'textfield',
                                                action: 'inputByDatePicker',
                                                eventAction: 'RMPROsubscriptionEdited',
                                                hidden: true,
                                                itemId: 'rmProSubscrPaymentDueDateFld',
                                                width: '250px',
                                                label: 'Due Date'
                                            }
                                        ]
                                    },
                                    {
                                        xtype: 'fieldset',
                                        margin: '4 0 0 0',
                                        layout: 'hbox',
                                        items: [
                                            {
                                                xtype: 'label',
                                                cls: [
                                                    'borderedDiv',
                                                    'fieldLbl'
                                                ],
                                                html: 'Subscription',
                                                margin: '2 0 2 0',
                                                style: 'font-size:0.8em;',
                                                width: '160px'
                                            },
                                            {
                                                xtype: 'label',
                                                cls: 'nbluehtml',
                                                html: 'Fawad Bokhari - 3/24/2014 13:43',
                                                itemId: 'rtInvoiceCreatedUserDtlsLbl',
                                                margin: '6 0 2 10'
                                            }
                                        ]
                                    },
                                    {
                                        xtype: 'fieldset',
                                        itemId: 'InvoiceSubscriptionListPanel',
                                        width: '100%',
                                        layout: 'fit',
                                        listeners: [
                                            {
                                                fn: function(component, eOpts) {

                                                    var headers = component.down("#headerList");
                                                    headers.setData([{}]);
                                                    headers.setItemTpl(
                                                    Ext.create('Ext.XTemplate',
                                                    '<div style="font-size: 1.0em;font-weight: bold;  background-color: gainsboro;" class="x-invoice-listtpl-main onlyBottomBorderDiv">',
                                                    '    <div style="width: 1%;margin-right: 0px;">',
                                                    '        <div style="width: 20px;" data-name="all"></div>',
                                                    '    </div>',

                                                    '    <div class="rightBorderDiv" style="width: 50%;margin-right: 0px;text-align: center;" data-name="module_name">',
                                                    '        Product/ Add Ons&nbsp;',
                                                    '    </div>',
                                                    '    <div class="" style="width: 0%;margin-right: 0px;text-align: center;" data-name="remark_val">',
                                                    '      &nbsp;',
                                                    '    </div>',
                                                    '    <div class="rightBorderDiv" style="width: 12%;text-align: center; " data-name="quantity">',
                                                    '        Qty&nbsp;',
                                                    '    </div>',
                                                    '    <div class="rightBorderDiv" style="width: 16%;text-align: center;" data-name="module_standard_price">',
                                                    '        Rate&nbsp;',
                                                    '    </div>',
                                                    '    <div style="width: 20%;text-align: center;" data-name="per_month">',
                                                    '        Per Month&nbsp;',
                                                    '    </div>',
                                                    '</div>'
                                                    )
                                                    );
                                                    headers.refresh();

                                                    var list = component.down('#mainList');

                                                    list.setStore( Ext.getStore('printInvoice.subscribedModulesStore') );
                                                    list.setItemTpl(
                                                    Ext.create('Ext.XTemplate',
                                                    '<div style="height:20px;" class="x-invoice-listtpl-main pointerCursor">',
                                                    '    <div style="width: 1%;">',

                                                    '    </div>',
                                                    '    <div class="rightBorderDiv" style="width: 50%;font-weight: bold;padding-left:1%;">{[this.getProductName(values)]}</div>',
                                                    '    <div class="" style="width: 0%;"></div>',

                                                    '    <div class="rightBorderDiv" style="width: 12%;text-align: center;">{quantity}</div>',
                                                    '    <div class="rightBorderDiv" style="width: 16%;text-align: right;padding-right: 1%;">$ {[formatNum(values.module_standard_price)]}</div>',
                                                    '    <div  style="width: 20%;text-align: right;padding-right: 0%;">$ {[formatNum(values.per_month)]}</div>',
                                                    '</div>',{

                                                        getProductName:function(values){
                                                            //remark_val

                                                            if(values.remark_val && values.remark_val !="" ){

                                                                var rVal = parseInt(values.remark_val) ;
                                                                var msg= "" ;

                                                                if(rVal > 2){

                                                                    switch(rVal){

                                                                        case 3:
                                                                        msg = "1M Free Trial" ;
                                                                        break ;
                                                                        case 4:
                                                                        msg = "2M Free Trial" ;
                                                                        break ;
                                                                        case 5:
                                                                        msg = "3M Free Trial" ;
                                                                        break ;
                                                                        case 6:
                                                                        msg = "6M Free Trial" ;
                                                                        break ;
                                                                        case 7:
                                                                        msg = "9M Free Trial" ;
                                                                        break ;
                                                                        case 8:
                                                                        msg = "1Yr Free Trial" ;
                                                                        break ;
                                                                    }

                                                                    msg = '<span style="color: green;">' + msg + '</span>'  ;
                                                                    return values.module_name + " - "+ msg ;
                                                                }
                                                            }

                                                            return values.module_name  ;

                                                        }
                                                    }

                                                    )
                                                    );


                                                    list.setItemHeight(20);


                                                    list.addCls('x-rm-rdvendorslist');

                                                    list.refresh() ;
                                                    /////////////////////////////////////////////////////////////////////////////
                                                },
                                                event: 'initialize'
                                            }
                                        ],
                                        items: [
                                            {
                                                xtype: 'listwithheader',
                                                cls: 'borderedDiv',
                                                itemId: 'allBillingModuleLstPanel',
                                                margin: '0 0 0 0',
                                                maxHeight: '450px'
                                            }
                                        ]
                                    },
                                    {
                                        xtype: 'panel',
                                        hidden: true,
                                        itemId: 'invoiceRmProPackageListPanel',
                                        margin: '0 0 0 0',
                                        width: '100%',
                                        layout: 'vbox',
                                        items: [
                                            {
                                                xtype: 'fieldset',
                                                baseCls: 'none',
                                                border: '0 0 0 0',
                                                layout: 'hbox',
                                                items: [
                                                    {
                                                        xtype: 'image',
                                                        height: '30px;',
                                                        itemId: 'myimg8',
                                                        width: 35,
                                                        src: 'resources/images/labelHeader/downArrow.png',
                                                        listeners: [
                                                            {
                                                                fn: function(component, eOpts) {
                                                                    component.element.on('tap',function(){

                                                                        var child = component.getParent().getParent().down('panel') ;
                                                                        child.setHidden(! child.getHidden());
                                                                        if( child.getHidden()){

                                                                            component.setSrc('resources/images/labelHeader/rightArrow.png');
                                                                        }else{
                                                                            component.setSrc('resources/images/labelHeader/downArrow.png') ;
                                                                        }

                                                                    });
                                                                },
                                                                event: 'initialize'
                                                            }
                                                        ]
                                                    },
                                                    {
                                                        xtype: 'label',
                                                        html: 'Package Name',
                                                        itemId: 'invoiceRmProPackNameLbl',
                                                        style: 'font-size:12px;'
                                                    },
                                                    {
                                                        xtype: 'label',
                                                        docked: 'right',
                                                        html: 'Bundel Price',
                                                        itemId: 'invoiceRmProBundelPriceLbl',
                                                        margin: '0 12% 0 0',
                                                        style: 'font-size:12px;'
                                                    }
                                                ]
                                            },
                                            {
                                                xtype: 'billingdetailedlistcontainer',
                                                height: '200px',
                                                hidden: false,
                                                itemId: 'invoiceRmProPackageListSubPanel',
                                                padding: '0 0 0 0'
                                            }
                                        ],
                                        listeners: [
                                            {
                                                fn: function(component, eOpts) {

                                                    var headers = component.down("#billingDetListHeader");
                                                    headers.setData([{}]);
                                                    headers.setItemTpl(
                                                    Ext.create('Ext.XTemplate',
                                                    '<div class="x-rm-listtpl-main">',
                                                    '    <div style="width: 6%;">',
                                                    '        <div style="width: 20px;" data-name="all"></div>',
                                                    '    </div>',

                                                    '    <div style="width: 20%;" data-name="module_name">',
                                                    '        Product Name&nbsp;<img src="resources/images/button_icons/downArrow.png"/>',
                                                    '    </div>',
                                                    '    <div style="width: 12%;" data-name="quantity">',
                                                    '        Qty&nbsp;<img src="resources/images/button_icons/downArrow.png"/>',
                                                    '    </div>',
                                                    '    <div style="width: 20%;" data-name="module_standard_price">',
                                                    '        Unit Price&nbsp;<img src="resources/images/button_icons/downArrow.png"/>',
                                                    '    </div>',
                                                    '    <div style="width: 20%;" data-name="module_promotional_price">',
                                                    '        Promotional Price&nbsp;<img src="resources/images/button_icons/downArrow.png"/>',
                                                    '    </div>',
                                                    '    <div style="width: 20%;" data-name="per_month">',
                                                    '        Amount&nbsp;<img src="resources/images/button_icons/downArrow.png"/>',
                                                    '    </div>',
                                                    '</div>'
                                                    )
                                                    );
                                                    headers.refresh();
                                                    var list = component.down('#billingDetList');
                                                    list.setStore(Ext.getStore('products.BillingFromPackages'));
                                                    list.setItemTpl(
                                                    Ext.create('Ext.XTemplate',
                                                    '<div class="x-rm-listtpl-main pointerCursor">',
                                                    '    <div style="width: 6%;">',
                                                    '    </div>',
                                                    '    <div style="width: 20%;">{module_name}</div>',
                                                    '    <div style="width: 12%;">{quantity}</div>',
                                                    '    <div style="width: 20%;padding-right: 1%;">{module_standard_price}</div>',
                                                    '    <div style="width: 20%;padding-right: 1%;">{module_promotional_price}</div>',
                                                    '    <div style="width: 20%;padding-right: 1%;"></div>',
                                                    '</div>'
                                                    )
                                                    );

                                                    // list.setMode("SINGLE");
                                                    //     list.on("select",function(rmProlist, record, eOpts){
                                                    //         RMdatalink.app.getController('RMProController').onProductRMProListSelect(rmProlist, record, eOpts);
                                                    // });

                                                    list.setItemHeight(22);
                                                    list.setMode('MULTI');
                                                    list.addCls('x-rm-rdvendorslist');


                                                    //////////////////////////////////////////////////////////////////////////

                                                },
                                                event: 'initialize'
                                            }
                                        ]
                                    },
                                    {
                                        xtype: 'panel',
                                        hidden: true,
                                        itemId: 'invoiceRmProAddOnsListPanel',
                                        margin: '0 0 0 0',
                                        padding: '0 0 0 0',
                                        width: '100%',
                                        layout: 'vbox',
                                        items: [
                                            {
                                                xtype: 'fieldset',
                                                baseCls: 'none',
                                                border: '0 0 0 0',
                                                hidden: true,
                                                layout: 'hbox',
                                                items: [
                                                    {
                                                        xtype: 'image',
                                                        height: '30px;',
                                                        itemId: 'myimg8',
                                                        width: 35,
                                                        src: 'resources/images/labelHeader/downArrow.png',
                                                        listeners: [
                                                            {
                                                                fn: function(component, eOpts) {
                                                                    component.element.on('tap',function(){

                                                                        var child = component.getParent().getParent().down('panel') ;
                                                                        child.setHidden(! child.getHidden());
                                                                        if( child.getHidden()){

                                                                            component.setSrc('resources/images/labelHeader/rightArrow.png');
                                                                        }else{
                                                                            component.setSrc('resources/images/labelHeader/downArrow.png') ;
                                                                        }

                                                                    });
                                                                },
                                                                event: 'initialize'
                                                            }
                                                        ]
                                                    },
                                                    {
                                                        xtype: 'label',
                                                        html: 'Add-ons',
                                                        itemId: 'mylabel58',
                                                        style: 'font-size:12px;'
                                                    }
                                                ]
                                            },
                                            {
                                                xtype: 'billingdetailedlistcontainer',
                                                height: '200px',
                                                hidden: true,
                                                itemId: 'invoiceRmProAddOnsListSubPanel',
                                                padding: '0 0 0 0'
                                            }
                                        ],
                                        listeners: [
                                            {
                                                fn: function(component, eOpts) {
                                                    var headers = component.down("#billingDetListHeader");
                                                    //headers.setData([{}]);
                                                    headers.setHidden(true);
                                                    headers.setItemTpl(
                                                    Ext.create('Ext.XTemplate',
                                                    '<div class="x-rm-listtpl-main">',
                                                    '    <div style="width: 6%;">',
                                                    '        <div style="width: 20px;" data-name="all"></div>',
                                                    '    </div>',

                                                    '    <div style="width: 20%;" data-name="module_name">',
                                                    '        Product Name&nbsp;<img src="resources/images/button_icons/downArrow.png"/>',
                                                    '    </div>',
                                                    '    <div style="width: 12%;" data-name="quantity">',
                                                    '        Qty&nbsp;<img src="resources/images/button_icons/downArrow.png"/>',
                                                    '    </div>',
                                                    '    <div style="width: 20%;" data-name="module_standard_price">',
                                                    '        Unit Price&nbsp;<img src="resources/images/button_icons/downArrow.png"/>',
                                                    '    </div>',
                                                    '    <div style="width: 20%;" data-name="module_promotional_price">',
                                                    '        Promotional Price&nbsp;<img src="resources/images/button_icons/downArrow.png"/>',
                                                    '    </div>',
                                                    '    <div style="width: 20%;" data-name="per_month">',
                                                    '        Amount&nbsp;<img src="resources/images/button_icons/downArrow.png"/>',
                                                    '    </div>',
                                                    '</div>'
                                                    )
                                                    );
                                                    headers.refresh();
                                                    var list = component.down('#billingDetList');
                                                    list.setStore(Ext.getStore('products.BillingModuleAddons'));
                                                    list.setItemTpl(
                                                    Ext.create('Ext.XTemplate',
                                                    '<div class="x-rm-listtpl-main pointerCursor">',
                                                    '    <div style="width: 6%;">',

                                                    '    </div>',

                                                    '    <div style="width: 20%;">{module_name}</div>',
                                                    '    <div style="width: 12%;">{quantity}</div>',
                                                    '    <div style="width: 20%;padding-right: 1%;">{module_standard_price}</div>',
                                                    '    <div style="width: 20%;padding-right: 1%;">{module_promotional_price}</div>',
                                                    '    <div style="width: 20%;padding-right: 1%;">{per_month}</div>',
                                                    '</div>'
                                                    )
                                                    );

                                                    ///////////////////
                                                    // list.setMode("SINGLE");
                                                    //     list.on("select",function(rmProlist, record, eOpts){
                                                    //         RMdatalink.app.getController('RMProController').onProductRMProListSelect(rmProlist, record, eOpts);
                                                    // });

                                                    list.setItemHeight(22);
                                                    list.setMode('MULTI');
                                                    list.addCls('x-rm-rdvendorslist');




                                                    /////////////////////////////////////////////////////////////////////////////
                                                },
                                                event: 'initialize'
                                            }
                                        ]
                                    },
                                    {
                                        xtype: 'fieldset',
                                        itemId: 'invoiceRmproBillingFldsPanel',
                                        width: '100%',
                                        items: [
                                            {
                                                xtype: 'fieldset',
                                                layout: {
                                                    type: 'hbox',
                                                    pack: 'end'
                                                },
                                                items: [
                                                    {
                                                        xtype: 'fieldset',
                                                        flex: 1,
                                                        height: '150px',
                                                        layout: 'vbox',
                                                        items: [
                                                            {
                                                                xtype: 'fieldset',
                                                                layout: {
                                                                    type: 'hbox',
                                                                    align: 'end',
                                                                    pack: 'end'
                                                                },
                                                                items: [
                                                                    {
                                                                        xtype: 'label',
                                                                        cls: [
                                                                            'fieldLbl',
                                                                            'borderedDiv'
                                                                        ],
                                                                        docked: 'left',
                                                                        html: 'Commissions',
                                                                        margin: '2 0 2 0',
                                                                        width: '160px'
                                                                    },
                                                                    {
                                                                        xtype: 'label',
                                                                        html: 'Amount Per Month:  ',
                                                                        margin: '0 2 10 2',
                                                                        style: 'font-size:0.8em;'
                                                                    },
                                                                    {
                                                                        xtype: 'label',
                                                                        itemId: 'InvoicemonthlySubscriptionLbl',
                                                                        margin: '0 40 10 0',
                                                                        style: 'font-size:0.8em;color:rgb(157, 8, 8);font-weight:bold;'
                                                                    }
                                                                ]
                                                            },
                                                            {
                                                                xtype: 'fieldset',
                                                                flex: 2,
                                                                cls: 'borderedDiv',
                                                                margin: '0 2 2 0',
                                                                layout: 'hbox',
                                                                items: [
                                                                    {
                                                                        xtype: 'fieldset',
                                                                        flex: 1,
                                                                        margin: '0 10px 0 0',
                                                                        padding: '6 0 0 0',
                                                                        width: '250px',
                                                                        items: [
                                                                            {
                                                                                xtype: 'searchfield',
                                                                                action: 'fillSearchDropDown',
                                                                                cls: 'x-field-techLogsearch',
                                                                                itemId: 'rtSalesPersonSearchFld',
                                                                                label: 'Salesperson(s)',
                                                                                labelWidth: '100px'
                                                                            },
                                                                            {
                                                                                xtype: 'textfield',
                                                                                action: 'invoiceRMproCommission',
                                                                                html: '<div style= "margin: -20px 0px 0px -10px;font-size: small;">$</div>',
                                                                                itemId: 'invoiceCommissionableAmtFld',
                                                                                label: 'Commissionable Amount:',
                                                                                labelWidth: '158px'
                                                                            },
                                                                            {
                                                                                xtype: 'textfield',
                                                                                action: 'invoiceRMproCommission',
                                                                                html: '<div style= "margin: -20px 0px 0px -14px;font-size: small;">%</div>',
                                                                                itemId: 'invoiceCommissionPercentFld',
                                                                                label: 'Commission percent:',
                                                                                labelWidth: '158px'
                                                                            }
                                                                        ]
                                                                    },
                                                                    {
                                                                        xtype: 'fieldset',
                                                                        flex: 1.5,
                                                                        itemId: 'rmProInvoiceSalesPersonsPanel',
                                                                        margin: '2 6 2 6',
                                                                        layout: 'vbox',
                                                                        items: [
                                                                            {
                                                                                xtype: 'listwithheader',
                                                                                height: '150px'
                                                                            }
                                                                        ],
                                                                        listeners: [
                                                                            {
                                                                                fn: function(component, eOpts) {
                                                                                    var headers = component.down("#headerList");
                                                                                    headers.setMargin(0);
                                                                                    headers.setHeight(0);
                                                                                    /*headers.setData([{}]);
                                                                                    headers.setItemTpl(
                                                                                    Ext.create('Ext.XTemplate',
                                                                                    '<div class="x-rm-listtpl-main" style="background-color: #DCDCDE ;">',

                                                                                    '    <div style="width: 40%;" data-name="discount_name">',
                                                                                    '        Advance Payment Benifits&nbsp;<img src="resources/images/button_icons/downArrow.png"/>',
                                                                                    '    </div>',
                                                                                    '    <div style="width: 15%;" data-name="discount_value">',
                                                                                    '        Discount&nbsp;<img src="resources/images/button_icons/downArrow.png"/>',
                                                                                    '    </div>',
                                                                                    '    <div style="width: 15%;" data-name="discount_saving">',
                                                                                    '        Saving&nbsp;<img src="resources/images/button_icons/downArrow.png"/>',
                                                                                    '    </div>',
                                                                                    '    <div style="width: 15%;" data-name="discount_total">',
                                                                                    '        Total&nbsp;<img src="resources/images/button_icons/downArrow.png"/>',
                                                                                    '    </div>',
                                                                                    '    <div style="width: 15%;" data-name="discount_per_month">',
                                                                                    '        Per Month&nbsp;<img src="resources/images/button_icons/downArrow.png"/>',
                                                                                    '    </div>',

                                                                                    '</div>'
                                                                                    )
                                                                                    );
                                                                                    headers.refresh();*/
                                                                                    var list = component.down('#mainList');
                                                                                    list.setMargin(0);
                                                                                    list.setStore(Ext.getStore('products.RtSalesPersonStore'));
                                                                                    list.setItemTpl(
                                                                                    Ext.create('Ext.XTemplate',
                                                                                    '<div class="x-rm-listtpl-main pointerCursor">',
                                                                                    '    <div style="width: 8%;"></div>',
                                                                                    '    <div style="width: 30%;padding: 0px 0px 0px 10px; padding-left: 7px;">{salesperson_name}</div>',
                                                                                    '    % <input type="text" style="width: 60% !important;text-align:left;" class="x-rm-rdinlinecmt billingDisable" data-id="{_id}" value="{salesperson_commission}" maxlength="24"',
                                                                                    '        onchange="RMdatalink.app.getController(\'InvoiceController\').updateSalesPersonsList(this,\'salesperson_commission\');"/><div style="margin-top: 2px;"></div>',
                                                                                    '    <div style="width: 30%; "> $ {[this.getCommissionAmt(values)]}</div>',
                                                                                    '</div>',
                                                                                    {
                                                                                        getCommissionAmt:function(values){

                                                                                            var form = Ext.ComponentQuery.query('#productRmproInvoicePanel')[0] ;


                                                                                            var cAmt =  form.down('#invoiceCommissionableAmtFld').getValue()  ;
                                                                                            var cAmtPerc =  form.down('#invoiceCommissionPercentFld').getValue()  ;
                                                                                            var sCom = values.salesperson_commission ;
                                                                                            if(cAmt && cAmtPerc && sCom && cAmt != "" && cAmtPerc != ""  && sCom != ""){

                                                                                                cAmt = parseFloat(cAmt);
                                                                                                cAmtPerc = parseFloat(cAmtPerc);
                                                                                                sCom = parseFloat(sCom);
                                                                                                var finalamt = cAmt * cAmtPerc ;

                                                                                                finalamt = finalamt / 100 ;

                                                                                                finalamt = finalamt  * sCom ;

                                                                                                finalamt = finalamt / 100 ;

                                                                                                finalamt = finalamt.toFixed(2) ;

                                                                                                return formatNum(finalamt) ;


                                                                                            }else{
                                                                                                return "0.00";
                                                                                            }
                                                                                        }
                                                                                    }
                                                                                    )
                                                                                    );
                                                                                    list.setItemHeight(22);
                                                                                    list.setMode("SINGLE");
                                                                                    list.addCls('x-rm-rdvendorslist');
                                                                                    list.addCls('delMark-list') ;

                                                                                    list.setDisableSelection(true);
                                                                                    list.setOnItemDisclosure(true);
                                                                                    list.refresh();

                                                                                    list.on("disclose",function(salesPersonList, record, eOpts){

                                                                                        if( Ext.ComponentQuery.query('#rtBillingSheetEditCancelBtn')[0].getText() != "Edit")
                                                                                        {

                                                                                            salesPersonList.getStore().remove(record) ;

                                                                                        }
                                                                                    });

                                                                                    //disclose( this, record, target, index, e, eOpts )
                                                                                },
                                                                                event: 'initialize'
                                                                            }
                                                                        ]
                                                                    }
                                                                ]
                                                            },
                                                            {
                                                                xtype: 'fieldset',
                                                                layout: {
                                                                    type: 'hbox',
                                                                    pack: 'center'
                                                                },
                                                                items: [
                                                                    {
                                                                        xtype: 'button',
                                                                        cls: [
                                                                            'borderedDiv',
                                                                            'newGrayBtn'
                                                                        ],
                                                                        height: '22px',
                                                                        hidden: true,
                                                                        margin: '2 10 2 10',
                                                                        minHeight: '24px',
                                                                        width: '100px',
                                                                        text: 'Clear'
                                                                    },
                                                                    {
                                                                        xtype: 'button',
                                                                        cls: [
                                                                            'borderedDiv',
                                                                            'newGrayBtn'
                                                                        ],
                                                                        height: '22px',
                                                                        hidden: true,
                                                                        margin: '2 10 2 10',
                                                                        minHeight: '24px',
                                                                        width: '100px',
                                                                        text: 'Apply'
                                                                    },
                                                                    {
                                                                        xtype: 'button',
                                                                        cls: [
                                                                            'borderedDiv',
                                                                            'newGrayBtn'
                                                                        ],
                                                                        height: '22px',
                                                                        hidden: true,
                                                                        margin: '2 10 2 10',
                                                                        minHeight: '24px',
                                                                        width: '100px',
                                                                        text: 'Cancel'
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    },
                                                    {
                                                        xtype: 'fieldset',
                                                        cls: 'borderedDiv',
                                                        margin: '2 0 2 0',
                                                        width: '280px',
                                                        layout: {
                                                            type: 'vbox',
                                                            align: 'end'
                                                        },
                                                        items: [
                                                            {
                                                                xtype: 'textfield',
                                                                isCurrency: true,
                                                                disabled: true,
                                                                html: '<div style= "margin: -18% 0% 0% -12%;font-size: small;">$</div>',
                                                                itemId: 'invoiceRmproSubtotal',
                                                                margin: '1 4% -1 0',
                                                                width: '250px',
                                                                inputCls: 'boldInputFld inputTextRightAlign',
                                                                label: 'Sub Total:',
                                                                labelWidth: '150px'
                                                            },
                                                            {
                                                                xtype: 'textfield',
                                                                disabled: true,
                                                                hidden: true,
                                                                itemId: 'invoiceRmproSaving',
                                                                width: '200px',
                                                                label: 'Saving',
                                                                labelWidth: '100px'
                                                            },
                                                            {
                                                                xtype: 'fieldset',
                                                                width: '280px',
                                                                layout: {
                                                                    type: 'vbox',
                                                                    align: 'end'
                                                                },
                                                                items: [
                                                                    {
                                                                        xtype: 'textfield',
                                                                        disabled: true,
                                                                        hidden: true,
                                                                        html: '<div style= "margin: -18% 0% 0% -14%;font-size: small;">%</div>',
                                                                        itemId: 'invoiceDiscountAppliedFld',
                                                                        width: '250px',
                                                                        label: 'Discount:',
                                                                        labelWidth: '150px'
                                                                    },
                                                                    {
                                                                        xtype: 'textfield',
                                                                        disabled: true,
                                                                        html: '<div style= "margin: -18% 0% 0% -12%;font-size: small;">$</div>',
                                                                        itemId: 'invoiceTotalSavingFld',
                                                                        margin: '1 4% 0 0 ',
                                                                        width: '250px',
                                                                        inputCls: 'inputTextRightAlign',
                                                                        label: 'Discount:',
                                                                        labelWidth: '150px'
                                                                    }
                                                                ]
                                                            },
                                                            {
                                                                xtype: 'fieldset',
                                                                width: '280px',
                                                                layout: {
                                                                    type: 'vbox',
                                                                    align: 'end'
                                                                },
                                                                items: [
                                                                    {
                                                                        xtype: 'textfield',
                                                                        eventAction: 'RMPROsubscriptionEdited',
                                                                        isCurrency: true,
                                                                        html: '<div style= "margin: -18% 0% 0% -12%;font-size: small;">$</div>',
                                                                        itemId: 'invoiceTotalPaybleFld',
                                                                        margin: '1 4% -1 0',
                                                                        width: '250px',
                                                                        clearIcon: false,
                                                                        inputCls: 'boldInputFld inputTextRightAlign',
                                                                        label: '<b>Amount Due:</b>',
                                                                        labelWidth: '150px'
                                                                    },
                                                                    {
                                                                        xtype: 'textfield',
                                                                        action: 'calRmproBalDue',
                                                                        hidden: true,
                                                                        html: '<div style= "margin: -18% 0% 0% -12%;font-size: small;">$</div>',
                                                                        itemId: 'invoicePastDueFld',
                                                                        width: '250px',
                                                                        label: 'Past Due:',
                                                                        labelWidth: '150px'
                                                                    },
                                                                    {
                                                                        xtype: 'textfield',
                                                                        isCurrency: true,
                                                                        disabled: true,
                                                                        html: '<div style= "margin: -18% 0% 0% -12%;font-size: small;">$</div>',
                                                                        itemId: 'invoiceAmmountFld',
                                                                        margin: '1 4% -1 0',
                                                                        width: '250px',
                                                                        clearIcon: false,
                                                                        inputCls: 'inputTextRightAlign',
                                                                        label: 'Amount Paid:',
                                                                        labelWidth: '150px'
                                                                    },
                                                                    {
                                                                        xtype: 'textfield',
                                                                        isCurrency: true,
                                                                        disabled: true,
                                                                        html: '<div style= "margin: -18% 0% 0% -12%;font-size: small;">$</div>',
                                                                        itemId: 'invoiceBalanceDueFld',
                                                                        margin: '0 4% 0 0',
                                                                        width: '250px',
                                                                        inputCls: 'inputTextRightAlign',
                                                                        label: 'Balance Due:',
                                                                        labelWidth: '150px'
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ]
                                            },
                                            {
                                                xtype: 'fieldset',
                                                padding: '0 0 0 0',
                                                layout: 'hbox'
                                            },
                                            {
                                                xtype: 'fieldset',
                                                itemId: 'rtBillingRmproPrevPaymntsView',
                                                layout: 'vbox',
                                                items: [
                                                    {
                                                        xtype: 'fieldset',
                                                        layout: 'hbox',
                                                        items: [
                                                            {
                                                                xtype: 'label',
                                                                cls: [
                                                                    'borderedDiv',
                                                                    'fieldLbl'
                                                                ],
                                                                html: 'Payment(s)',
                                                                margin: '2 0 2 0',
                                                                style: 'font-size:0.8em;',
                                                                width: '160px'
                                                            },
                                                            {
                                                                xtype: 'label',
                                                                cls: 'nbluehtml',
                                                                html: 'Fawad Bokhari - 3/24/2014 13:43',
                                                                itemId: 'rtInvoiceLastUpdatedUserDtlsLbl',
                                                                margin: '6 0 2 10'
                                                            },
                                                            {
                                                                xtype: 'button',
                                                                handler: function(button, e) {
                                                                    var date = RMdatalink.util.globalMethods.getAmToday() ;
                                                                    var user = RMdatalink.app.getController('LoginHandler').getUserDetails().userName;
                                                                    var amDue = Ext.ComponentQuery.query('#invoiceTotalPaybleFld')[0].getValue() ;
                                                                    var amPaid = Ext.ComponentQuery.query('#invoiceAmmountFld')[0].getValue() ;
                                                                    var amount = amDue - amPaid ;

                                                                    if(amount < 0){

                                                                        amount = 0 ;

                                                                    }

                                                                    var processedBy = "" ;
                                                                    var dataToAdd ={
                                                                        proccessed_by: user,
                                                                        pay_date: date,
                                                                        payment_method_detail: "",
                                                                        paid_by: "None",

                                                                        ammount_paying: amount,
                                                                        cc_approval: "",
                                                                        date: date
                                                                    };

                                                                    Ext.getStore('InvoicePaymentsStore').add(dataToAdd);


                                                                    RMdatalink.app.getController('InvoiceController').handleAmountPaid() ;
                                                                },
                                                                cls: [
                                                                    'x-rm-blueBtn',
                                                                    'x-rm-rdopenbtns',
                                                                    'x-rm-smalliconbtns'
                                                                ],
                                                                docked: 'right',
                                                                height: '25px',
                                                                itemId: 'billingInvoiceAddPaymentsBtn',
                                                                width: '50px',
                                                                icon: 'resources//images//retailerDetail//add_btn.png',
                                                                iconAlign: 'center'
                                                            }
                                                        ]
                                                    },
                                                    {
                                                        xtype: 'fieldset'
                                                    },
                                                    {
                                                        xtype: 'listwithheader',
                                                        cls: 'borderedDiv',
                                                        height: '120px',
                                                        itemId: 'listwithheader4',
                                                        width: '100%'
                                                    }
                                                ],
                                                listeners: [
                                                    {
                                                        fn: function(component, eOpts) {
                                                            /*

                                                            proccessed_by: ""
                                                            pay_date: "06/17/2014"
                                                            payment_method_detail: ""
                                                            paid_by: "cash"

                                                            ammount_paying: "400"
                                                            cc_approval: ""
                                                            date: "06/17/2014"



                                                            */

                                                            ///////////////////////////////////////////////////////////

                                                            var headers = component.down("#headerList");
                                                            headers.setData([{}]);
                                                            headers.setItemTpl(
                                                            Ext.create('Ext.XTemplate',
                                                            '<div style="font-size: 1.0em;font-weight: bold; height: 94%;  background-color: gainsboro;" class="x-rm-listtpl-main onlyBottomBorderDiv">',

                                                            '    <div class="rightBorderDiv" style="margin-right: -2px; width: 16%;text-align: center;" data-name="pay_date">',
                                                            '        Date&nbsp;',
                                                            '    </div>',
                                                            '    <div class="rightBorderDiv" style="width: 16%;text-align: center;" data-name="paid_by">',
                                                            '        Method&nbsp;',
                                                            '    </div>',
                                                            '    <div class="rightBorderDiv" style="width: 16%;text-align: center;" data-name="payment_method_detail">',
                                                            '        Number&nbsp;',
                                                            '    </div>',
                                                            '    <div class="rightBorderDiv" style="width: 16%;text-align: center;" data-name="cc_approval">',
                                                            '       Approval&nbsp;',
                                                            '    </div>',
                                                            '    <div class="rightBorderDiv" style="width: 16%;text-align: center;" data-name="ammount_paying">',
                                                            '        Amount&nbsp;',
                                                            '    </div>',
                                                            '    <div style="width: 16%;text-align: center;" data-name="ammount_paying">',
                                                            '        Commission&nbsp;',
                                                            '    </div>',

                                                            '</div>'
                                                            )
                                                            );

                                                            headers.refresh();

                                                            var list = component.down('#mainList');

                                                            list.setStore(Ext.getStore('InvoicePaymentsStore'));
                                                            list.setItemTpl(
                                                            Ext.create('Ext.XTemplate',
                                                            '<div style="font-size: 1.0em;" class="x-rm-listtpl-main pointerCursor">',
                                                            '<div class="" style="width: 2%;"></div>',
                                                            '<div class="rightBorderDiv" style="width: 14%;text-align: center; margin-right: -4px;height: 16px;margin-top: 2px; " multipleBillFld="pay_date">{pay_date}</div>',


                                                            '   <div class="rightBorderDiv" style="width: 16%;">',

                                                            '<select class="billingDisable" data-id="{id}" onchange="RMdatalink.app.getController(\'InvoiceController\').updateMultiplePaymentList(this,\'paid_by\');" style="width: 96%; margin-left:2%;height: 16px;margin-top: 0px;">',
                                                            '<option value="None" {[this.getSelected(values,"None")]}></option>',
                                                            '<option value="Cash" {[this.getSelected(values,"Cash")]}>Cash</option>',
                                                            '<option value="Check" {[this.getSelected(values,"Check")]}>Check</option>',
                                                            '<option value="amex" {[this.getSelected(values,"amex")]} >amex</option>',
                                                            '<option value="Visa" {[this.getSelected(values,"Visa")]} >Visa</option>',
                                                            '<option value="Master" {[this.getSelected(values,"Master")]} >Master</option>',
                                                            '<option value="Discover" {[this.getSelected(values,"Discover")]} >Discover</option>',

                                                            '</select>',
                                                            '</div>',


                                                            '<div class="rightBorderDiv" style="width: 16%;text-align: center;">',
                                                            '    <input type="text" style="width: 92% !important;margin-left: 4%;height: 16px;text-align: center;" class="x-rm-rdinlinecmt billingDisable" data-id="{id}" value="{payment_method_detail}" maxlength="24"',
                                                            '        onchange="RMdatalink.app.getController(\'InvoiceController\').updateMultiplePaymentList(this,\'payment_method_detail\');"/>',
                                                            '</div>',


                                                            '<div class="rightBorderDiv" style="width: 16%;text-align: center;">',
                                                            '    <input type="text" style="width: 92% !important;margin-left: 4%;height: 16px;text-align: center;" class="x-rm-rdinlinecmt billingDisable" data-id="{id}" value="{cc_approval}" maxlength="24"',
                                                            '        onchange="RMdatalink.app.getController(\'InvoiceController\').updateMultiplePaymentList(this,\'cc_approval\');"/>',
                                                            '</div>',

                                                            '<div class="rightBorderDiv" style="width: 16%;text-align: center;"><span style="">$</span>',
                                                            '    <input type="text" style="width: 88% !important;margin-left: 4%;height: 16px;text-align: right;margin-top: -12%;" class="x-rm-rdinlinecmt billingDisable" data-id="{id}" value="{[formatNum(values.ammount_paying)]}" maxlength="24"',
                                                            '        onchange="RMdatalink.app.getController(\'InvoiceController\').updateMultiplePaymentList(this,\'ammount_paying\');"/>',
                                                            '</div>',


                                                            '<div style="width: 16%;text-align: right;">$ {commission}</div>',
                                                            '</div>',
                                                            {

                                                                getSelected:function(value,cmp){

                                                                    if(value.paid_by && value.paid_by == cmp){
                                                                        return "selected";
                                                                    }

                                                                    return "";

                                                                }

                                                            }
                                                            )
                                                            );



                                                            list.setItemHeight(22);
                                                            list.setMode('MULTI');
                                                            list.addCls('x-rm-rdvendorslist');

                                                            list.addCls('delMark-list') ;

                                                            list.setDisableSelection(true);
                                                            list.setOnItemDisclosure(true);
                                                            list.refresh();

                                                            list.on("disclose",function(salesPersonList, record, eOpts){

                                                                if( Ext.ComponentQuery.query('#rtBillingSheetEditCancelBtn')[0].getText() != "Edit")
                                                                {

                                                                    salesPersonList.getStore().remove(record) ;
                                                                    RMdatalink.app.getController('InvoiceController').handleAmountPaid() ;

                                                                }
                                                            });
                                                        },
                                                        event: 'initialize'
                                                    }
                                                ]
                                            },
                                            {
                                                xtype: 'fieldset',
                                                cls: 'borderedDiv',
                                                margin: '4 0 4 0',
                                                padding: '0 0 0 0',
                                                items: [
                                                    {
                                                        xtype: 'textfield',
                                                        itemId: 'rmProPaymentNoteFld',
                                                        margin: '0 0 0 0',
                                                        padding: '0 0 0 0',
                                                        style: 'background-color: gainsboro !important;',
                                                        inputCls: 'onlyLeftBorderDiv',
                                                        label: 'Note:',
                                                        labelCls: 'grayFldLbl',
                                                        labelWidth: '60px',
                                                        placeHolder: ' if any (printable)'
                                                    }
                                                ]
                                            },
                                            {
                                                xtype: 'fieldset',
                                                hidden: true,
                                                layout: 'hbox',
                                                items: [
                                                    {
                                                        xtype: 'fieldset',
                                                        layout: 'vbox',
                                                        title: '<div style="font-size:12px;">Payments</div>',
                                                        items: [
                                                            {
                                                                xtype: 'textfield',
                                                                action: 'inputByDatePicker',
                                                                itemId: 'invoicePayDateFld',
                                                                label: 'Pay Date',
                                                                labelWidth: '100px'
                                                            },
                                                            {
                                                                xtype: 'selectfield',
                                                                itemId: 'invoicePaidByFld',
                                                                label: 'Paid By',
                                                                labelWidth: '100px',
                                                                options: [
                                                                    {
                                                                        text: 'by Cash',
                                                                        value: 'cash'
                                                                    },
                                                                    {
                                                                        text: 'by Check',
                                                                        value: 'check'
                                                                    },
                                                                    {
                                                                        text: 'by Am Express',
                                                                        value: 'am_express'
                                                                    }
                                                                ]
                                                            },
                                                            {
                                                                xtype: 'textfield',
                                                                itemId: 'invoicePaymentDetailFld',
                                                                label: 'Check # / CC #',
                                                                labelWidth: '100px'
                                                            },
                                                            {
                                                                xtype: 'textfield',
                                                                itemId: 'invoiceCCApprovalFld',
                                                                label: 'CCApproval',
                                                                labelWidth: '100px'
                                                            }
                                                        ]
                                                    },
                                                    {
                                                        xtype: 'fieldset',
                                                        margin: '35px 5px 0 10px',
                                                        layout: 'vbox',
                                                        items: [
                                                            {
                                                                xtype: 'textfield',
                                                                html: '<div style= "margin: -12% 0% 0% -8%;font-size: small;">$</div>',
                                                                itemId: 'invoiceCommissionFld',
                                                                label: 'Commission',
                                                                labelWidth: '100px'
                                                            },
                                                            {
                                                                xtype: 'textfield',
                                                                itemId: 'invoiceProcessedByFld',
                                                                label: 'Proccessed By',
                                                                labelWidth: '100px'
                                                            },
                                                            {
                                                                xtype: 'textfield',
                                                                action: 'inputByDatePicker',
                                                                itemId: 'invoiceRMProDateFld',
                                                                label: 'Date',
                                                                labelWidth: '100px'
                                                            }
                                                        ]
                                                    },
                                                    {
                                                        xtype: 'fieldset',
                                                        height: '145px',
                                                        margin: '40px 0 0 0',
                                                        width: '160px',
                                                        layout: {
                                                            type: 'vbox',
                                                            align: 'end',
                                                            pack: 'end'
                                                        },
                                                        items: [
                                                            {
                                                                xtype: 'label',
                                                                html: 'Note:',
                                                                style: 'font-size:80%;',
                                                                width: '100%'
                                                            },
                                                            {
                                                                xtype: 'textareafield',
                                                                height: '60px',
                                                                itemId: 'rmProPaymentNoteFld123',
                                                                margin: '0 0 5 0',
                                                                width: '100%',
                                                                labelWidth: '0%'
                                                            }
                                                        ]
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        xtype: 'fieldset',
                                        cls: 'x-rm-no_borderflds',
                                        width: '100%',
                                        layout: {
                                            type: 'hbox',
                                            align: 'center',
                                            pack: 'center'
                                        },
                                        items: [
                                            {
                                                xtype: 'button',
                                                cls: 'x-rm-blueBtn',
                                                height: '25px',
                                                itemId: 'invoiceRMPROProductSetupBtn',
                                                margin: '10 20 10 0',
                                                width: '150px',
                                                text: 'Product Setup'
                                            },
                                            {
                                                xtype: 'button',
                                                handler: function(button, e) {
                                                    var LicenseScreen ;

                                                    if(Ext.ComponentQuery.query("#LicenseScreen")[0])
                                                    {

                                                        LicenseScreen =  Ext.ComponentQuery.query("#LicenseScreen")[0];

                                                    }else{

                                                        LicenseScreen =  Ext.widget('LicenseScreen');
                                                    }


                                                    LicenseScreen.show() ;
                                                },
                                                cls: 'x-rm-blueBtn',
                                                height: '25px',
                                                itemId: 'billingGotoLicenseBtn',
                                                margin: '10 20 10 0',
                                                width: '150px',
                                                text: 'License'
                                            },
                                            {
                                                xtype: 'button',
                                                handler: function(button, e) {
                                                    var that = this ;

                                                    if(RMdatalink.app.getController('InvoiceHistoryController').config.displayGeneratedInvoice || true){
                                                        if(Ext.ComponentQuery.query('#InvoicePage')[0]){

                                                            Ext.ComponentQuery.query('#InvoicePage')[0].destroy() ;
                                                        }






                                                        var printTimeout = setTimeout(function(){


                                                            Ext.widget('InvoicePage').show();
                                                            RMdatalink.app.getController('InvoiceController').setRMproInvoiceToPrint();

                                                            clearTimeout(printTimeout);


                                                        },100);
                                                        return ;
                                                    }


                                                    return ;

                                                    var rmProInvoicePanel = Ext.ComponentQuery.query('#productRmproInvoicePanel')[0] ;

                                                    if(! rmProInvoicePanel.down('#invoiceAmmountFld').getValue() || rmProInvoicePanel.down('#invoiceAmmountFld').getValue() <= 0){

                                                        Ext.Msg.alert("Alert","Please Enter Ammount.");
                                                        return ;
                                                    }

                                                    if(! rmProInvoicePanel.down('#invoiceBalanceDueFld').getValue() || rmProInvoicePanel.down('#invoiceBalanceDueFld').getValue() <= 0 ){


                                                        RMdatalink.app.getController('InvoiceController').config.isSalesCommissionForRmPro = true ;
                                                        RMdatalink.app.getController('InvoiceController').saveRmProInvoice(true,"product_rmpro");


                                                    }

                                                    else{


                                                        if(Ext.ComponentQuery.query('#InvoicePage')[0]){

                                                            Ext.ComponentQuery.query('#InvoicePage')[0].destroy() ;
                                                        }



                                                        RMdatalink.app.getController('InvoiceController').addRmProPartialPayment() ;


                                                        var printTimeout = setTimeout(function(){


                                                            Ext.widget('InvoicePage').show();
                                                            RMdatalink.app.getController('InvoiceController').setRMproInvoiceToPrint();
                                                            RMdatalink.app.getController('InvoiceController').hideShowPrintPaymentInfo(true);
                                                            clearTimeout(printTimeout);


                                                        },100);
                                                    }
                                                },
                                                cls: 'x-rm-blueBtn',
                                                height: '25px',
                                                itemId: 'invoiceRmProPrintBtn',
                                                margin: '0 20 0 0',
                                                width: '150px',
                                                text: 'Print Invoice'
                                            }
                                        ]
                                    }
                                ]
                            }
                        ]
                    },
                    {
                        xtype: 'tabpanel',
                        flex: 4,
                        cls: 'x-rm-tabpanel',
                        hidden: true,
                        itemId: 'billingDetailsMainTabPanel',
                        ui: 'light',
                        tabBar: {
                            docked: 'top',
                            width: '90%'
                        }
                    },
                    {
                        xtype: 'container',
                        flex: 2,
                        cls: 'borderedDiv',
                        itemId: 'billingDetailsSideContainer',
                        margin: '2 0 0 2',
                        padding: '2 4 2 4',
                        layout: 'vbox',
                        items: [
                            {
                                xtype: 'fieldset',
                                hidden: true,
                                itemId: 'invoiceCurrentSubscriptionsListPanel',
                                margin: '0 0 0 0',
                                padding: '0 0 0 0',
                                width: '100%',
                                items: [
                                    {
                                        xtype: 'label',
                                        cls: [
                                            'borderedDiv',
                                            'fieldLbl'
                                        ],
                                        html: 'Current Subscriptions',
                                        margin: '2 2 2 2',
                                        width: '160px'
                                    },
                                    {
                                        xtype: 'listwithheader',
                                        cls: 'borderedDiv',
                                        height: 82
                                    }
                                ],
                                listeners: [
                                    {
                                        fn: function(component, eOpts) {
                                            var headers = component.down("#headerList");
                                            headers.setData([{}]);
                                            headers.setItemTpl(
                                            Ext.create('Ext.XTemplate',
                                            '<div style="font-weight: bold;  background-color: gainsboro;" class="x-rm-listtpl-main onlyBottomBorderDiv">',
                                            '    <div style="width: 4%;">',
                                            '        <div style="width: 20px;" data-name="all"></div>',
                                            '    </div>',
                                            '    <div class="rightBorderDiv" style="width: 24%;" data-name="invoice_number">',
                                            '        Invoice No&nbsp;<img src="resources/images/button_icons/downArrow.png"/>',
                                            '    </div>',
                                            '    <div class="rightBorderDiv" style="width: 24%;" data-name="invoice_product">',
                                            '        Product&nbsp;<img src="resources/images/button_icons/downArrow.png"/>',
                                            '    </div>',
                                            '    <div class="rightBorderDiv" style="width: 20%;" data-name="due_date">',
                                            '        Due Date&nbsp;<img src="resources/images/button_icons/downArrow.png"/>',
                                            '    </div>',
                                            '    <div style="width: 24%;" data-name="total_payble">',
                                            '        Amount&nbsp;<img src="resources/images/button_icons/downArrow.png"/>',
                                            '    </div>',
                                            '</div>'
                                            )
                                            );
                                            headers.refresh();
                                            var list = component.down('#mainList');
                                            list.setStore(Ext.getStore('CurrentInvoiceStore'));
                                            list.setItemTpl(
                                            Ext.create('Ext.XTemplate',
                                            '<div class="x-rm-listtpl-main pointerCursor">',
                                            '    <div style="width: 4%;">',
                                            '    </div>',
                                            '    <div class="rightBorderDiv" style="width: 24%;">{invoice_number}</div>',
                                            '    <div class="rightBorderDiv" style="width: 24%;">{[this.getProductType(values)]}</div>',
                                            '    <div class="rightBorderDiv" style="width: 20%;padding-right: 4%;text-align: right;">{due_date}</div>',
                                            '    <div style="width: 24%;padding-right: 4%;text-align: right;">$ {[formatNum(values.total_payble)]}</div>',
                                            '</div>',
                                            {
                                                getProductType:function(record){

                                                    if(record.invoice_product == "product_datalink"){

                                                        return "Datalink" ;
                                                    }else if(record.invoice_product == "product_rmpro"){
                                                        return "RMPro" ;
                                                    }else if(record.invoice_product == "product_ecom"){
                                                        return "E-Commerce" ;
                                                    }

                                                    return "";

                                                }

                                            }
                                            )
                                            );

                                            list.setMode("SINGLE");

                                            list.setAllowDeselect(false);

                                            list.on("select",function(invoiceList, record, eOpts){
                                                var historyInvoiceList = Ext.ComponentQuery.query('#billingDtHistoryListPanel')[0].down('#mainList');
                                                historyInvoiceList.deselectAll() ;

                                                RMdatalink.app.getController('InvoiceHistoryController').onHistoryInvoiceSelect(invoiceList, record, eOpts);
                                            });

                                            list.setItemHeight(22);
                                        },
                                        event: 'initialize'
                                    }
                                ]
                            },
                            {
                                xtype: 'label',
                                cls: [
                                    'borderedDiv',
                                    'fieldLbl'
                                ],
                                html: 'Subscriptions',
                                margin: '2 2 2 2',
                                width: '160px'
                            },
                            {
                                xtype: 'formpanel',
                                flex: 1,
                                cls: 'x-rm-rdformpanel',
                                height: '100%',
                                itemId: 'billingDtHistoryListPanel',
                                padding: '2 2 2 2',
                                scrollable: false,
                                layout: {
                                    type: 'vbox',
                                    align: 'start',
                                    pack: 'center'
                                },
                                items: [
                                    {
                                        xtype: 'fieldset',
                                        cls: [
                                            'x-rm-rdformpanel',
                                            'noBorderFldSet'
                                        ],
                                        margin: '2 0 5 0',
                                        width: '98%',
                                        layout: 'hbox',
                                        items: [
                                            {
                                                xtype: 'searchfield',
                                                flex: 1,
                                                cls: 'x-field-techLogsearch',
                                                itemId: 'biilingInvoiceSearchForRtTxtFld'
                                            },
                                            {
                                                xtype: 'button',
                                                cls: 'x-rm-blueBtn',
                                                height: '25px',
                                                itemId: 'biilingInvoiceSearchForRtBtn',
                                                margin: '0 5 0 5',
                                                width: '60px',
                                                text: 'Search'
                                            },
                                            {
                                                xtype: 'button',
                                                cls: [
                                                    'x-rm-detailsSaveBtn',
                                                    'x-rm-detailsInnerBtns'
                                                ],
                                                height: '25px',
                                                itemId: 'biilingInvoiceDeleteBtn',
                                                margin: '0 5 0 5',
                                                minHeight: '25px',
                                                width: '60px',
                                                text: 'Delete'
                                            }
                                        ]
                                    },
                                    {
                                        xtype: 'listwithheader',
                                        cls: 'borderedDiv',
                                        width: '100%',
                                        flex: 1
                                    },
                                    {
                                        xtype: 'button',
                                        cls: 'x-rm-blueBtn',
                                        docked: 'top',
                                        height: '25px',
                                        hidden: true,
                                        itemId: 'billingDtlsViewCurrentSubBtn',
                                        width: '100%',
                                        iconCls: 'arrow_left',
                                        text: 'View Current Subscriptions'
                                    }
                                ],
                                listeners: [
                                    {
                                        fn: function(component, eOpts) {

                                            var headers = component.down("#headerList");
                                            headers.setData([{}]);
                                            headers.setItemTpl(
                                            Ext.create('Ext.XTemplate',
                                            '<div style="font-weight: bold;  background-color: gainsboro;" class="x-rm-listtpl-main onlyBottomBorderDiv">',
                                            '    <div style="width: 4%;">',
                                            '        <div style="width: 20px;" data-name="all"></div>',
                                            '    </div>',
                                            '    <div class="rightBorderDiv" style="width: 22%;" data-name="invoice_number">',
                                            '        Invoice No&nbsp;<img src="resources/images/button_icons/downArrow.png"/>',
                                            '    </div>',
                                            '    <div class="rightBorderDiv" style="width: 16%;" data-name="invoice_product">',
                                            '        Product&nbsp;<img src="resources/images/button_icons/downArrow.png"/>',
                                            '    </div>',
                                            '    <div class="rightBorderDiv" style="width: 18%;" data-name="due_date">',
                                            '        Due Date&nbsp;<img src="resources/images/button_icons/downArrow.png"/>',
                                            '    </div>',
                                            '    <div class="rightBorderDiv" style="width: 20%;" data-name="total_payble">',
                                            '        Amount&nbsp;<img src="resources/images/button_icons/downArrow.png"/>',
                                            '    </div>',
                                            '    <div style="width: 16%;" data-name="payment_status">',
                                            '        Status&nbsp;<img src="resources/images/button_icons/downArrow.png"/>',
                                            '    </div>',
                                            '</div>'
                                            )
                                            );
                                            headers.refresh();
                                            var list = component.down('#mainList');
                                            list.setStore( Ext.getStore('InvoiceHistoryStore') );
                                            list.setItemTpl(
                                            Ext.create('Ext.XTemplate',
                                            '<div style = "height: 20px;padding-top: 0px;" class="x-rm-listtpl-main pointerCursor">',
                                            '    <div style="width: 4%;margin-right: 0px;">',
                                            '    </div>',
                                            '    <div class="rightBorderDiv" style="width: 22%;">{invoice_number}</div>',
                                            '    <div class="rightBorderDiv" style="width: 16%;">{[this.getProductType(values)]}</div>',
                                            '    <div class="rightBorderDiv" style="width: 18%;padding-right: 2%;text-align: right;">{due_date:date("m/d/Y")}</div>',
                                            '    <div class="rightBorderDiv" style="width: 20%;padding-right:2%;text-align: right;">$ {[formatNum(values.total_payble)]}</div>',
                                            '    <div style="width: 16%;text-align:center;">{[this.getPaymentStatus(values)]}</div>',
                                            '</div>',
                                            {
                                                getProductType:function(record){

                                                    if(record.invoice_product == "product_datalink"){

                                                        return "Datalink" ;
                                                    }else if(record.invoice_product == "product_rmpro"){
                                                        return "RMPro" ;
                                                    }else if(record.invoice_product == "product_ecom"){
                                                        return "E-Commerce" ;
                                                    }else if(record.invoice_product == "product_vip"){
                                                        return "VIP" ;
                                                    }

                                                    return "";

                                                },
                                                getPaymentStatus:function(record){
                                                    if(! record.payment_status){
                                                        return "Paid" ;
                                                    }

                                                    if( record.payment_status == "paid"){
                                                        return "Paid" ;
                                                    }else{
                                                        return '<span style="color: rgb(157, 8, 8);">Unpaid </span>' ;
                                                    }

                                                }

                                            }
                                            )
                                            );

                                            list.setMode("SINGLE");

                                            list.setAllowDeselect(false);

                                            list.on("select",function(invoiceList, record, eOpts){

                                                var currentInvoiceLst = Ext.ComponentQuery.query('#invoiceCurrentSubscriptionsListPanel')[0].down('#mainList');
                                                currentInvoiceLst.deselectAll() ;

                                                RMdatalink.app.getController('InvoiceHistoryController').onHistoryInvoiceSelect(invoiceList, record, eOpts);
                                            });

                                            list.setItemHeight(22);

                                            //list.addCls('x-rm-rdvendorslist');

                                        },
                                        event: 'initialize'
                                    }
                                ]
                            }
                        ]
                    }
                ]
            }
        ],
        listeners: [
            {
                fn: 'onInvoiceCommissionableAmtFldChange',
                event: 'change',
                delegate: '#invoiceCommissionableAmtFld'
            },
            {
                fn: 'onListItemTap',
                event: 'itemtap',
                delegate: '#listwithheader4 #mainList'
            },
            {
                fn: 'onContainerInitialize',
                event: 'initialize'
            },
            {
                fn: 'onContainerPainted',
                event: 'painted'
            }
        ]
    },

    onInvoiceCommissionableAmtFldChange: function(textfield, newValue, oldValue, eOpts) {
        var mainList = Ext.ComponentQuery.query('#rmProInvoiceSalesPersonsPanel')[0].down('#mainList')  ;
        mainList.refresh() ;
        mainList.getStore().sync()  ;
    },

    onListItemTap: function(dataview, index, target, record, e, eOpts) {
        //multipleBillFld="pay_date"


        var edtViewBtn = Ext.ComponentQuery.query('#rtBillingSheetEditCancelBtn')[0];

        if(edtViewBtn.getText() == "Edit" ){

            return ;
        }

        var attrToSearch = "multipleBillFld";
        var targetEl = e.target;


        // delegateAttr="onCartTap"

        if( RMdatalink.util.globalConfig.isAttributePresentInTarget( attrToSearch,targetEl )  ){

                 var attrVak = targetEl.getAttribute(attrToSearch);

                 if(attrVak == "pay_date")
                 {

                      RMdatalink.util.Calendar.showCalendar(fn,target);
                            if(calendarPanelPicker)
                            {
                                calendarPanelPicker.setZIndex(52);
                            }

                 }
        }



                function fn(newDate){

                      var date = Ext.Date.format(newDate, "m/d/Y");
                      record.set("pay_date",date);

                      RMdatalink.util.Calendar.hideCalendar();



                    var prevPay  = Ext.ComponentQuery.query('#rtBillingRmproPrevPaymntsView')[0].getEl() ;
                    var multiPayDtFlds = prevPay.query('div[multipleBillFld="pay_date"]') ;

                    for( var i = 0 ; i< multiPayDtFlds.length ; i++ ){

                            multiPayDtFlds[i].style.setProperty("background-color", "white", "important");
                            multiPayDtFlds[i].style.setProperty("border", "1px solid #9b9b9b", "important");

                    }


                }






    },

    onContainerInitialize: function(component, eOpts) {
        // component.down('#detailsSaveBtn').setHidden(false);



        // component.down('#detailsSaveBtn').element.on("tap",function(){

        //                 if(RMdatalink.app.getController('InvoiceHistoryController').config.displayGeneratedInvoice )
        //                 {
        //                       RMdatalink.app.getController('InvoiceHistoryController').updateInvoice() ;
        //                 }
        //                 else{

        //                     RMdatalink.app.getController('InvoiceController').saveRmProInvoice();
        //                 }


        // });

    },

    onContainerPainted: function(element, eOpts) {
         window.location.hash = 'billingDetailCard';

         //RMdatalink.app.getController('InvoiceController').hiedeAllProductsPanel() ;
    }

});
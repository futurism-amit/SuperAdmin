/*
 * File: app/store/pricing/MainStore.js
 *
 * This file was generated by Sencha Architect version 3.0.4.
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Sencha Touch 2.3.x library, under independent license.
 * License of Sencha Architect does not include license for Sencha Touch 2.3.x. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('RMdatalink.store.pricing.MainStore', {
    extend: 'Ext.data.Store',

    requires: [
        'RMdatalink.model.pricing.MainDataModel'
    ],

    config: {
        totalNoOfPages: 1,
        cachedData: {
            
        },
        pageNo: 1,
        model: 'RMdatalink.model.pricing.MainDataModel',
        storeId: 'pricing.MainStore',
        listeners: [
            {
                fn: 'onStoreUpdaterecord',
                event: 'updaterecord'
            }
        ]
    },

    onStoreUpdaterecord: function(store, record, newIndex, oldIndex, modifiedFieldNames, modifiedValues, eOpts) {
        //RMdatalink.util.DataLoader.onRetailerMasterStoreUpdate(store,record,newIndex,oldIndex,modifiedFieldNames,modifiedValues,eOpts);



        if(RMdatalink.app.getController('DlPricingController').config.isPricingUpdated){

            RMdatalink.app.getController('DlPricingController').config.isPricingUpdated = false ;
            return ;
        }

        //alert("priceing update");

        var _id = record.data._id ;

        var rec =  {

            active_discount_policy: record.data.active_discount_policy,
            active_pricing_policy: record.data.active_pricing_policy,
            advance_payment_discounts: record.data.advance_payment_discounts,
            discount_policy:record.data.discount_policy,
            pricing_policy: record.data.pricing_policy,
            product_name: record.data.product_name


        };

        RMdatalink.iwa.rdl.doUpdateCollection(store, rec , _id, success, error);

        function success(){

           // alert("priceing update success");
        }

        function error(){

            alert("priceing update error");
        }
    }

});
{
    "type": "Ext.app.Controller",
    "reference": {
        "name": "items",
        "type": "array"
    },
    "codeClass": null,
    "userConfig": {
        "designer|userClassName": "PermissionsConroller"
    },
    "designerId": "c1105c9e-15a0-43fb-ae90-73303d691bf6",
    "cn": [
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|controlQuery": "selectfield[itemId=selectUserRoleSelectFld]",
                "designer|targetType": "Ext.field.Select",
                "fn": "onselectUserRoleSelectFldChange",
                "implHandler": [
                    "\r",
                    "//Ext.ComponentQuery.query('#addEditUserRoleTextFld')[0].setValue(newValue) ;\r",
                    "\r",
                    "console.log(newValue) ;\r",
                    "console.log(arguments);\r",
                    "\r",
                    "var PermisstionsStore = Ext.getStore('PermisstionsStore') ;\r",
                    "\r",
                    "var rec = PermisstionsStore.findRecord(\"user_role\",newValue) ;\r",
                    "\r",
                    "if(! rec){\r",
                    "    return ;\r",
                    "}\r",
                    "\r",
                    "      var permissions = rec.data.permissions ;\r",
                    "\r",
                    "\r",
                    "   permissionsPanel = Ext.ComponentQuery.query('#PermissionsSelectorPage')[0] ;\r",
                    "    if(permissions){\r",
                    "\r",
                    "                for(var i =0 ; i< permissions.length ; i++){\r",
                    "                    if(permissions[i].value == \"-1\"){\r",
                    "                        var val = null;\r",
                    "                    }else{\r",
                    "                        var val = permissions[i].value ;\r",
                    "                    }\r",
                    "                     permissionsPanel.down(\"#permistions\"+permissions[i].type).setValue(val);\r",
                    "\r",
                    "                }\r",
                    "            }\r",
                    "\r",
                    ""
                ],
                "name": "change"
            },
            "designerId": "9e63d0c3-5d16-4e34-8e84-16ceb1ba2834"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|controlQuery": "textfield[itemId=addEditUserRoleTextFld]",
                "designer|targetType": "Ext.field.Text",
                "fn": "onaddEditUserRoleTextFldChange",
                "implHandler": [
                    "/*var permissinSelectFld = Ext.ComponentQuery.query('#selectUserRoleSelectFld')[0] ;\r",
                    "var options = permissinSelectFld.getOptions();\r",
                    "var addUpdateButton = Ext.ComponentQuery.query('#addUpdateUserRoleButton')[0] ;\r",
                    "\r",
                    "if(options)\r",
                    "for(var i=0;i<options.length; i++){\r",
                    "\r",
                    "    var opt = options[i].user_role ;\r",
                    "\r",
                    "    if(opt == newValue){\r",
                    "\r",
                    "        permissinSelectFld.setValue(opt);\r",
                    "         addUpdateButton.setText(\"Update Role\");\r",
                    "    }else{\r",
                    "\r",
                    "        addUpdateButton.setText(\"Add New Role\");\r",
                    "\r",
                    "    }\r",
                    "}\r",
                    "*/"
                ],
                "name": "change"
            },
            "designerId": "7d3a312c-520a-4555-8f9b-50a36493639f"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|controlQuery": "button[itemId=addUpdateUserRoleButton]",
                "designer|targetType": "Ext.Button",
                "fn": "onaddUpdateUserRoleButtonTap",
                "implHandler": [
                    "\r",
                    "\r",
                    "\r",
                    "var permissionsStore =  Ext.getStore('PermisstionsStore') ;\r",
                    "\r",
                    "var newUserRole  = Ext.ComponentQuery.query('#addEditUserRoleTextFld')[0].getValue() ;\r",
                    "\r",
                    "    if(newUserRole){\r",
                    "\r",
                    "\r",
                    "            var recIndex = permissionsStore.findExact(\"user_role\",newUserRole);\r",
                    "\r",
                    "            if(recIndex == -1)\r",
                    "            {\r",
                    "                this.addNewPermission() ;\r",
                    "            }\r",
                    "            else{\r",
                    "\r",
                    "               Ext.Msg.alert(\"Alert\",\"User Role already exists.\",Ext.emptyFn);\r",
                    "\r",
                    "\r",
                    "            }\r",
                    "\r",
                    "    }"
                ],
                "name": "tap"
            },
            "designerId": "d282fcd2-3718-4205-95a2-d77eeec7bfae"
        },
        {
            "type": "basicfunction",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "fn": "addNewPermission",
                "implHandler": [
                    "var permissions = [\r",
                    "    {\r",
                    "\r",
                    "        \"name\":\"Dashboard\",\r",
                    "        \"type\":\"Dashboard\",\r",
                    "        value:\"-1\"\r",
                    "    },\r",
                    "   {\r",
                    "\r",
                    "        name:\"Retailers\",\r",
                    "        type:\"Retailers\",\r",
                    "        value:\"-1\"\r",
                    "    },\r",
                    "\r",
                    "\r",
                    "   {\r",
                    "\r",
                    "        name:\"Billing\",\r",
                    "        type:\"Billing\",\r",
                    "       value:\"-1\"\r",
                    "    },\r",
                    "\r",
                    "\r",
                    "\r",
                    "   {\r",
                    "\r",
                    "        name:\"Vendors\",\r",
                    "        type:\"Vendors\",\r",
                    "        value:\"-1\"\r",
                    "    },\r",
                    "\r",
                    "   {\r",
                    "\r",
                    "        name:\"In house\",\r",
                    "        type:\"Inhouse\",\r",
                    "       value:\"-1\"\r",
                    "    },\r",
                    "              {\r",
                    "\r",
                    "        \"name\":\"Notification\",\r",
                    "        \"type\":\"Notification\",\r",
                    "        value:\"-1\"\r",
                    "    },\r",
                    "\r",
                    "      {\r",
                    "\r",
                    "        \"name\":\"Notepad\",\r",
                    "        \"type\":\"Notepad\",\r",
                    "       value:\"-1\"\r",
                    "    },\r",
                    "        {\r",
                    "\r",
                    "        \"name\":\"Products\",\r",
                    "        \"type\":\"Products\",\r",
                    "        value:\"-1\"\r",
                    "    },\r",
                    "\r",
                    "\r",
                    "       {\r",
                    "\r",
                    "        name:\"Products-Datalink\",\r",
                    "        type:\"Products_Datalink\",\r",
                    "        value:\"-1\"\r",
                    "    },\r",
                    "{\r",
                    "\r",
                    "        name:\"Products-Ecatalog\",\r",
                    "        type:\"Products_Ecatalog\",\r",
                    "        value:\"-1\"\r",
                    "    },\r",
                    "{\r",
                    "\r",
                    "        name:\"Products-SMART CART\",\r",
                    "        type:\"Products_SMART_CART\",\r",
                    "       value:\"-1\"\r",
                    "    },\r",
                    "{\r",
                    "\r",
                    "        name:\"Products-RM PLC\",\r",
                    "        type:\"Products_RM_PLC\",\r",
                    "       value:\"-1\"\r",
                    "    },\r",
                    "{\r",
                    "\r",
                    "        name:\"Products-IRUGZ\",\r",
                    "        type:\"Products_IRUGZ\",\r",
                    "       value:\"-1\"\r",
                    "    },\r",
                    "\r",
                    "\r",
                    "    {\r",
                    "\r",
                    "        \"name\":\"Pricing\",\r",
                    "        \"type\":\"Pricing\",\r",
                    "        value:\"-1\"\r",
                    "    },\r",
                    "\r",
                    "\r",
                    "       {\r",
                    "\r",
                    "        name:\"Pricing-Datalink\",\r",
                    "        type:\"Pricing_Datalink\",\r",
                    "       value:\"-1\"\r",
                    "    },\r",
                    "{\r",
                    "\r",
                    "        name:\"Pricing-Ecatalog\",\r",
                    "        type:\"Pricing_Ecatalog\",\r",
                    "       value:\"-1\"\r",
                    "    },\r",
                    "{\r",
                    "\r",
                    "        name:\"Pricing-SMART CART\",\r",
                    "        type:\"Pricing_SMART_CART\",\r",
                    "       value:\"-1\"\r",
                    "\r",
                    "    },\r",
                    "{\r",
                    "\r",
                    "        name:\"Pricing-RM PLC\",\r",
                    "        type:\"Pricing_RM_PLC\",\r",
                    "       value:\"-1\"\r",
                    "    },\r",
                    "{\r",
                    "\r",
                    "        name:\"Pricing-IRUGZ\",\r",
                    "        type:\"Pricing_IRUGZ\",\r",
                    "       value:\"-1\"\r",
                    "    },\r",
                    "\r",
                    "\r",
                    "\r",
                    "    {\r",
                    "\r",
                    "        \"name\":\"Discounts\",\r",
                    "        \"type\":\"Discounts\",\r",
                    "         value:\"-1\"\r",
                    "    },\r",
                    "\r",
                    "\r",
                    "       {\r",
                    "\r",
                    "        name:\"Discounts-Datalink\",\r",
                    "        type:\"Discounts_Datalink\",\r",
                    "        value:\"-1\"\r",
                    "    },\r",
                    "{\r",
                    "\r",
                    "        name:\"Discounts-Ecatalog\",\r",
                    "        type:\"Discounts_Ecatalog\",\r",
                    "        value:\"-1\"\r",
                    "    },\r",
                    "{\r",
                    "\r",
                    "        name:\"Discounts-SMART CART\",\r",
                    "        type:\"Discounts_SMART_CART\",\r",
                    "        value:\"-1\"\r",
                    "    },\r",
                    "{\r",
                    "\r",
                    "        name:\"Discounts-RM PLC\",\r",
                    "        type:\"Discounts_RM_PLC\",\r",
                    "        value:\"-1\"\r",
                    "    },\r",
                    "{\r",
                    "\r",
                    "        name:\"Discounts-IRUGZ\",\r",
                    "        type:\"Discounts_IRUGZ\",\r",
                    "        value:\"-1\"\r",
                    "    }\r",
                    "\r",
                    "\r",
                    "\r",
                    "\r",
                    "\r",
                    "\r",
                    "\r",
                    "];\r",
                    "\r",
                    "\r",
                    "\r",
                    "\r",
                    "   var permissionsPanel = Ext.ComponentQuery.query('#PermissionsSelectorPage')[0] ;\r",
                    "\r",
                    "     var slectFields = permissionsPanel.query('[xtype=selectfield]');\r",
                    "\r",
                    "               for(var i =0 ; i< permissions.length ; i++){\r",
                    "\r",
                    "                     val = permissionsPanel.down(\"#permistions\"+permissions[i].type).getValue();\r",
                    "                   if(val != null){\r",
                    "                       permissions[i].value = val ;\r",
                    "                   }\r",
                    "\r",
                    "                }\r",
                    "\r",
                    "\r",
                    "var userRole = Ext.ComponentQuery.query('#addEditUserRoleTextFld')[0].getValue() ;\r",
                    "\r",
                    "var recordToinsert = {\r",
                    "    user_role:userRole,\r",
                    "    permissions :  permissions\r",
                    "};\r",
                    "\r",
                    "var permissionsStore =  Ext.getStore('PermisstionsStore') ;\r",
                    "\r",
                    "  RMdatalink.util.DataLoader.sendNewRecordForInHouseToServer(recordToinsert, permissionsStore, successCall, errorCall) ;\r",
                    "\r",
                    "          Ext.Viewport.setMasked( {\r",
                    "                xtype: 'loadmask'\r",
                    "            });\r",
                    "\r",
                    "\r",
                    "function successCall(){\r",
                    "\r",
                    "    permissionsStore.add(recordToinsert);\r",
                    "    permissionsStore.sync() ;\r",
                    "    Ext.Viewport.setMasked(false);\r",
                    "    try{\r",
                    "        Ext.ComponentQuery.query('#addEditUserRoleTextFld')[0].setValue(\"\");\r",
                    "    }catch(ex){\r",
                    "\r",
                    "    }\r",
                    "\r",
                    "\r",
                    "}\r",
                    "\r",
                    "function errorCall(){\r",
                    "      Ext.Viewport.setMasked(false);\r",
                    "}"
                ]
            },
            "designerId": "ffcb8ab5-7245-43ad-8f25-a0a2e212bd45"
        },
        {
            "type": "basicfunction",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|params": [
                    "userRole",
                    "permissions"
                ],
                "fn": "updateUserRole",
                "implHandler": [
                    "if(!userRole){\r",
                    "\r",
                    "    Ext.Msg.alert(\"Alert\",\"Please select user role first\",Ext.emptyFn);\r",
                    "    return ;\r",
                    "}\r",
                    "\r",
                    "Ext.Msg.confirm(\"Confirm\",\"Are you sure you want to change predefined user role\",onMessageAns ,this);\r",
                    "\r",
                    "\r",
                    "function onMessageAns(action,opt,confirmBox){\r",
                    "\r",
                    "\r",
                    "    if(action == \"yes\"){\r",
                    "\r",
                    "        updatePermissions() ;\r",
                    "\r",
                    "\r",
                    "    }else{\r",
                    "\r",
                    "\r",
                    "    }\r",
                    "\r",
                    "\r",
                    "}\r",
                    "\r",
                    "var record ;\r",
                    "function updatePermissions(){\r",
                    "\r",
                    "    var permissionStore = Ext.getStore('PermisstionsStore') ;\r",
                    "\r",
                    "    var recIndex = permissionStore.findExact(\"user_role\",userRole);\r",
                    "     record = permissionStore.getAt(recIndex);\r",
                    "    var dataToUpdate = new Object() ;\r",
                    "\r",
                    "    dataToUpdate = record.data ;\r",
                    "\r",
                    "    var search_id = record.raw._id ;\r",
                    "\r",
                    "\r",
                    "\r",
                    "  console.error(search_id) ;\r",
                    "      console.error(dataToUpdate) ;\r",
                    "\r",
                    "     Ext.Viewport.setMasked({\r",
                    "                    xtype: 'loadmask'\r",
                    "                });\r",
                    "\r",
                    "\r",
                    "     RMdatalink.iwa.rdl.doUpdateCollection(permissionStore, dataToUpdate ,search_id , successcallback , errorcallback);\r",
                    "\r",
                    "}\r",
                    "\r",
                    "function successcallback(){\r",
                    "         Ext.Viewport.setMasked(false);\r",
                    "    record.set(\"permissions\",permissions);\r",
                    "    Ext.ComponentQuery.query('#PermissionsSelectorPage')[0].hide() ;\r",
                    "}\r",
                    "\r",
                    "\r",
                    "function errorcallback(){\r",
                    "     Ext.Viewport.setMasked(false);\r",
                    "      Ext.Msg.alert(\"Alert\",\"Error occured, please try again\",Ext.emptyFn);\r",
                    "}"
                ]
            },
            "designerId": "4177c504-8b41-4707-b762-de9f04da235c"
        },
        {
            "type": "basicfunction",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "fn": "showPermissions",
                "implHandler": [
                    "      var permissionsPanel ;\r",
                    "    permissionsPanel = Ext.ComponentQuery.query('#PermissionsSelectorPage')[0] ;\r",
                    "    if(permissionsPanel){\r",
                    "         permissionsPanel.show();\r",
                    "    }\r",
                    "    else{\r",
                    "       permissionsPanel =  Ext.create('RMdatalink.view.PermissionsSelector', {\r",
                    "                                height:'96%',\r",
                    "                                width:'90%',\r",
                    "                                 modal: true,\r",
                    "                                hideOnMaskTap: true,\r",
                    "                                showAnimation: {\r",
                    "                                    type: 'popIn',\r",
                    "                                    duration: 250,\r",
                    "                                    easing: 'ease-out'\r",
                    "                                },\r",
                    "                                hideAnimation: {\r",
                    "                                    type: 'popOut',\r",
                    "                                    duration: 250,\r",
                    "                                    easing: 'ease-out'\r",
                    "                                },\r",
                    "                                centered:true\r",
                    "                            });\r",
                    "                            permissionsPanel.show();\r",
                    "    }\r",
                    "\r",
                    "\r",
                    "\r",
                    "/*\r",
                    "        if(!  that.isNewRecordBtnTapped){\r",
                    "\r",
                    "           Ext.ComponentQuery.query('#selectUserRoleSelectFld')[0].setValue(that.selectedInhouseUser.data.user_role);\r",
                    "            setOptionsOfPermissions();\r",
                    "        }else{\r",
                    "\r",
                    "            var slectFields = permissionsPanel.query('[xtype=selectfield]');\r",
                    "\r",
                    "            for(var i=0 ;i < slectFields.length; i++){\r",
                    "                slectFields[i].setValue(null);\r",
                    "            }\r",
                    "        }\r",
                    "\r",
                    "        function setOptionsOfPermissions(){\r",
                    "            var permissions = that.selectedInhouseUser.data.permissions ;\r",
                    "\r",
                    "            console.log(that.selectedInhouseUser);\r",
                    "\r",
                    "            if(permissions){\r",
                    "\r",
                    "                for(var i =0 ; i< permissions.length ; i++){\r",
                    "                    if(permissions[i].value == \"-1\"){\r",
                    "                        var val = null;\r",
                    "                    }else{\r",
                    "                        var val = permissions[i].value ;\r",
                    "                    }\r",
                    "                     permissionsPanel.down(\"#permistions\"+permissions[i].type).setValue(val);\r",
                    "\r",
                    "                }\r",
                    "            }\r",
                    "\r",
                    "\r",
                    "        }\r",
                    "*/"
                ]
            },
            "designerId": "1b0fc4de-a67f-44be-bcfc-57e91ae6dc95"
        }
    ]
}
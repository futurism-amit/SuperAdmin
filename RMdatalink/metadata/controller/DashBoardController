{
    "type": "Ext.app.Controller",
    "reference": {
        "name": "items",
        "type": "array"
    },
    "codeClass": null,
    "userConfig": {
        "designer|userAlias": "DashBoardController",
        "designer|userClassName": "DashBoardController"
    },
    "designerId": "18ea50fd-f4fb-4817-8d32-1682759570c7",
    "cn": [
        {
            "type": "basicfunction",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "fn": "loadVIPStoreInDashBoard",
                "implHandler": [
                    "\r",
                    "var store = Ext.getStore(\"vendors.Master\");\r",
                    "var vipDashBoard= Ext.ComponentQuery.query(\"#vipDashBoard\")[0];\r",
                    "var component = vipDashBoard;\r",
                    "var list = component.down('#mainList');\r",
                    "var keyOfRetailer  = 'promo_code_info';\r",
                    "var flagofRetailer = 'is_promo_code_active';\r",
                    "var storemaster = Ext.getStore('vendors.Master');\r",
                    "var data = storemaster.getData();\r",
                    "\r",
                    "var optionArray = [];\r",
                    "\r",
                    "data.all.forEach(function(obj){\r",
                    "\r",
                    "    var values = obj.data;\r",
                    "    if( values.is_promo_code_active   && values[keyOfRetailer] ){\r",
                    "\r",
                    "        optionArray.push(obj.raw);\r",
                    "\r",
                    "    }\r",
                    "});\r",
                    "var storeOfList = list.getStore();\r",
                    "if(optionArray.length){\r",
                    "    if(storeOfList){\r",
                    "        storeOfList.setData(optionArray);\r",
                    "    }else{\r",
                    "        list.setData(optionArray);\r",
                    "    }\r",
                    "\r",
                    "}\r",
                    "\r",
                    "\r",
                    "this.getCountForVIPDashBoard();"
                ]
            },
            "designerId": "046ec165-c2cc-4df9-bd39-5af20cbcd486"
        },
        {
            "type": "basicfunction",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "fn": "getCountForVIPDashBoard",
                "implHandler": [
                    "\r",
                    "\r",
                    "var fnToExecute = function(){\r",
                    "    var vipDashBoard= Ext.ComponentQuery.query(\"#vipDashBoard\")[0];\r",
                    "    var component = vipDashBoard;\r",
                    "    var list = component.down('#mainList');\r",
                    "    var storeOfList = list.getStore();\r",
                    "\r",
                    "    if( storeOfList){\r",
                    "\r",
                    "    }else{\r",
                    "        return;\r",
                    "    }\r",
                    "    var data = storeOfList.getData();\r",
                    "\r",
                    "    var optionArray = [];\r",
                    "\r",
                    "\r",
                    "    for(  var i =0 ;i <data.all.length ; i++){\r",
                    "\r",
                    "        var record = storeOfList.getAt(i);\r",
                    "\r",
                    "        this[fnToCall](record);\r",
                    "        //this.getCountProspectRetailer(record);\r",
                    "        \r",
                    "    }\r",
                    "\r",
                    "};\r",
                    "var me = this;\r",
                    "\r",
                    "\r",
                    "var fnToCall  = 'getCountActiveRetailer';\r",
                    "\r",
                    "\r",
                    "// SOCKET CANNOT TAKE MANY MULTIPLE REQUEST SIMULTANEOUSLY.\r",
                    "\r",
                    "// SEND REQUEST SEPERATELY\r",
                    "\r",
                    "\r",
                    "    fnToCall  = 'getCountActiveRetailer';\r",
                    "    fnToExecute.call(me);\r",
                    "\r",
                    "\r",
                    "setTimeout( function(){\r",
                    "    fnToCall  = 'getCountProspectRetailer';\r",
                    "    fnToExecute.call(me);\r",
                    "} ,2000 );\r",
                    ""
                ]
            },
            "designerId": "663ce4fb-5cf5-4429-b10c-aaa1a444896f"
        },
        {
            "type": "basicfunction",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|params": [
                    "record"
                ],
                "fn": "getCountActiveRetailer",
                "implHandler": [
                    "\r",
                    "\r",
                    "var vendor_name = record.data.vendor_name;\r",
                    "var queryToExecute = getSearchQuery({\r",
                    "\r",
                    "    VendorPartner:vendor_name\r",
                    "});\r",
                    "\r",
                    "\r",
                    "startSearch(queryToExecute) ;\r",
                    "\r",
                    "\r",
                    "function getSearchQuery(values){\r",
                    "\r",
                    "    var query = {} ;\r",
                    "    query.$and = [] ;\r",
                    "    var temp = { $or:[] };\r",
                    "    var q = {} ;\r",
                    "\r",
                    "\r",
                    "\r",
                    "    if(  values.VendorPartner){\r",
                    "\r",
                    "\r",
                    "\r",
                    "        query.$and.push(\r",
                    "            {\r",
                    "                'e_commerce_info.vip_vendor': values.VendorPartner\r",
                    "            }\r",
                    "\r",
                    "        );\r",
                    "        query.$and.push(\r",
                    "            {\r",
                    "                'store_products.vip_status': \"ACTIVE\"\r",
                    "            }\r",
                    "\r",
                    "        );\r",
                    "    }\r",
                    "\r",
                    "\r",
                    "\r",
                    "    return query ;\r",
                    "}\r",
                    "\r",
                    "\r",
                    "\r",
                    "\r",
                    "\r",
                    "function startSearch(qry){\r",
                    "    var searchQuery =  qry ;\r",
                    "    RMdatalink.iwa.rdl.queryDB({collection: dbEnv + \"rdl_masterretailerrecords\",pageNo:1,pageSize: 50 ,sortBy:{\"store_name\":1},\r",
                    "                                query:searchQuery,fields:{ '_id':1}},success,error);\r",
                    "\r",
                    "\r",
                    "\r",
                    "}\r",
                    "\r",
                    "\r",
                    "\r",
                    "\r",
                    "var me = this;\r",
                    "function success(){\r",
                    "\r",
                    "    console.log(\"1\" , arguments);\r",
                    "    \r",
                    "    record.set('totalVIPActiveVendor' , arguments[0].count );\r",
                    "    me.setTotalListOfVIPDashBoard();\r",
                    "\r",
                    "}\r",
                    "\r",
                    "function error(){\r",
                    "\r",
                    "    console.log(\"2\" , arguments);\r",
                    "\r",
                    "}\r",
                    "\r",
                    "\r",
                    "\r",
                    "\r",
                    "\r",
                    "\r",
                    "\r",
                    "\r",
                    "\r",
                    "\r",
                    "\r",
                    "\r",
                    "\r",
                    "\r",
                    ""
                ]
            },
            "designerId": "7071de0e-7083-4391-b74c-89efabeb9ae8"
        },
        {
            "type": "basicfunction",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|params": [
                    "record"
                ],
                "fn": "getCountProspectRetailer",
                "implHandler": [
                    "\r",
                    "var vendor_name = record.data.vendor_name;\r",
                    "var queryToExecute = getSearchQuery({\r",
                    "\r",
                    "    VendorPartner:vendor_name\r",
                    "});\r",
                    "\r",
                    "\r",
                    "\r",
                    "\r",
                    "startSearch(queryToExecute) ;\r",
                    "\r",
                    "function getSearchQuery(values){\r",
                    "\r",
                    "    var query = {} ;\r",
                    "    query.$and = [] ;\r",
                    "    var temp = { $or:[] };\r",
                    "    var q = {} ;\r",
                    "\r",
                    "\r",
                    "\r",
                    "    if(  values.VendorPartner){\r",
                    "\r",
                    "\r",
                    "\r",
                    "        query.$and.push(\r",
                    "            {\r",
                    "                'e_commerce_info.vip_vendor': values.VendorPartner\r",
                    "            }\r",
                    "\r",
                    "        );\r",
                    "        query.$and.push(\r",
                    "            {\r",
                    "                'store_products.vip_status': {\r",
                    "                    \r",
                    "                    \"$ne\":\"ACTIVE\"\r",
                    "                }\r",
                    "            }\r",
                    "\r",
                    "        );\r",
                    "    }\r",
                    "\r",
                    "\r",
                    "    \r",
                    "    return query ;\r",
                    "}\r",
                    "\r",
                    "\r",
                    "\r",
                    "\r",
                    "\r",
                    "\r",
                    "function startSearch(qry){\r",
                    "    var searchQuery =  qry ;\r",
                    "    RMdatalink.iwa.rdl.queryDB({collection: dbEnv + \"rdl_masterretailerrecords\",pageNo:1,pageSize: 50 ,sortBy:{\"store_name\":1},\r",
                    "                                query:searchQuery,fields:{ '_id':1 }},success,error);\r",
                    "\r",
                    "\r",
                    "\r",
                    "}\r",
                    "\r",
                    "\r",
                    "\r",
                    "\r",
                    "var me = this;\r",
                    "function success(){\r",
                    "\r",
                    "    console.warn(\"1\" , arguments);\r",
                    "    record.set('totalVIPProspectRetailer' , arguments[0].count );\r",
                    "    me.setTotalListOfVIPDashBoard();\r",
                    "}\r",
                    "\r",
                    "function error(){\r",
                    "\r",
                    "    console.error(\"2\" , arguments);\r",
                    "\r",
                    "}\r",
                    "\r",
                    "\r",
                    "\r",
                    "\r",
                    "\r",
                    "\r",
                    "\r",
                    "\r",
                    "\r",
                    "\r",
                    "\r",
                    "\r",
                    "\r",
                    "\r",
                    ""
                ]
            },
            "designerId": "8475fa07-099d-42af-9b5d-aa7bd2c0c6f9"
        },
        {
            "type": "basicfunction",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "fn": "setTotalListOfVIPDashBoard",
                "implHandler": [
                    "var vipDashBoard = Ext.ComponentQuery.query(\"#vipDashBoard\")[0];\r",
                    "\r",
                    "var vipTotalsList = vipDashBoard.query(\"#vipTotalsList\")[0];\r",
                    "var vipTotalsListStore = vipTotalsList.getStore();\r",
                    "var component = vipDashBoard;\r",
                    "var list = component.down('#mainList');\r",
                    "var storeOfList = list.getStore();\r",
                    "\r",
                    "\r",
                    "var active_total = 0;\r",
                    "var prospect_total = 0;\r",
                    "\r",
                    "\r",
                    "try{\r",
                    "    var data = storeOfList.getData();\r",
                    "    data.all.forEach(function(obj){\r",
                    "        // TAKE PRECAUTION FOR NAN\r",
                    "        active_total += parseInt(obj.data.totalVIPActiveVendor)? parseInt(obj.data.totalVIPActiveVendor) : 0 ;\r",
                    "        prospect_total += parseInt(obj.data.totalVIPProspectRetailer) ? parseInt(obj.data.totalVIPProspectRetailer):0;\r",
                    "    });\r",
                    "    vipTotalsListStore.setData([{\r",
                    "        \r",
                    "        active_total:active_total,\r",
                    "        prospect_total:prospect_total\r",
                    "    }]);\r",
                    "}catch(e){\r",
                    "    console.log(e);\r",
                    "    \r",
                    "}\r",
                    "\r",
                    ""
                ]
            },
            "designerId": "6e4a11ab-0b84-48bc-9142-d06d535243d8"
        }
    ]
}